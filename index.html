<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Negotiation Gauntlet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .scenario-card {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            transition: all 0.2s ease-in-out;
        }
        .scenario-card:not(.locked):hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: #3b82f6;
        }
        .scenario-card.locked {
            background-color: #f3f4f6;
            color: #6b7280;
        }
        .scenario-card.locked.can-unlock {
             background-color: #eff6ff;
             color: #1d4ed8;
             cursor: pointer;
        }
        .scenario-card.locked.can-unlock:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: #2563eb;
        }
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        #negotiation-log::-webkit-scrollbar {
            width: 8px;
        }
        #negotiation-log::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        #negotiation-log::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 4px;
        }
        .option-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .perspective-switch-btn.active {
            background-color: #3b82f6;
            color: white;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <!-- Password Protection Screen -->
    <div id="password-screen" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-sm text-center">
            <h2 class="text-2xl font-bold mb-4">Enter Password</h2>
            <p class="text-slate-600 mb-6">This game is password protected.</p>
            <input type="password" id="password-input" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4" placeholder="Password">
            <button id="password-submit" class="w-full btn bg-blue-500 text-white font-bold py-2 px-4 rounded-lg">Submit</button>
            <p id="password-error" class="text-red-500 mt-4 h-4"></p>
        </div>
    </div>


    <!-- Main Game Container (hidden by default) -->
    <div id="game-container" class="max-w-5xl mx-auto p-4 md:p-8 hidden">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Negotiation Gauntlet</h1>
            <div class="text-right">
                <h2 class="text-lg font-semibold text-blue-600">Total Points</h2>
                <p id="total-points-display" class="text-2xl font-bold">0 NP</p>
            </div>
        </div>

        <!-- Scenario Selection Screen -->
        <div id="scenario-selection" class="text-center">
            <h2 class="text-2xl font-semibold mb-4">Choose Your Challenge</h2>
            <div id="scenario-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Scenarios will be dynamically inserted here -->
            </div>
        </div>

        <!-- Main Game Screen -->
        <div id="game-screen" class="hidden">
            <div id="scenario-briefing" class="mb-6 p-6 rounded-lg shadow-md bg-white">
                <h2 id="scenario-title" class="text-2xl font-bold mb-3"></h2>
                <p id="scenario-context" class="mb-4"></p>
                <div class="p-4 rounded-lg bg-blue-50 border border-blue-200">
                    <h3 class="font-bold text-blue-800">Your Goal</h3>
                    <p id="scenario-goal" class="text-blue-700"></p>
                </div>
            </div>

            <!-- Analysis & Strategy Section -->
            <div id="strategy-phase" class="mb-6 p-6 rounded-lg shadow-md bg-white">
                <h2 class="text-xl font-bold mb-4 border-b pb-2">Strategy & Analysis</h2>
                 <div class="flex justify-center mb-4 border border-slate-200 rounded-lg p-1 bg-slate-50">
                    <button id="player-perspective-btn" class="perspective-switch-btn flex-1 p-2 rounded-md text-sm font-medium active">Your Perspective</button>
                    <button id="counterpart-perspective-btn" class="perspective-switch-btn flex-1 p-2 rounded-md text-sm font-medium">Counterpart's Perspective</button>
                </div>
                
                <div id="player-perspective">
                    <div class="mb-4">
                        <label for="player-batna" class="block font-semibold mb-1">Define Your BATNA (Best Alternative to a Negotiated Agreement):</label>
                        <p id="player-batna-text" class="text-sm text-slate-600 p-3 bg-slate-50 rounded-md"></p>
                    </div>
                    <div>
                        <label for="player-zopa" class="block font-semibold mb-1">Define Your ZOPA (Zone of Possible Agreement):</label>
                         <div class="flex space-x-4 text-sm">
                            <div class="flex-1 p-3 bg-red-50 text-red-700 rounded-md"><strong>Walk-away Point:</strong> <span id="player-zopa-walkaway"></span></div>
                            <div class="flex-1 p-3 bg-green-50 text-green-700 rounded-md"><strong>Target:</strong> <span id="player-zopa-target"></span></div>
                        </div>
                    </div>
                </div>

                <div id="counterpart-perspective" class="hidden">
                    <div class="mb-4">
                        <label for="counterpart-batna" class="block font-semibold mb-1">Estimate Counterpart's BATNA:</label>
                        <p id="counterpart-batna-text" class="text-sm text-slate-600 p-3 bg-slate-50 rounded-md"></p>
                    </div>
                     <div>
                        <label for="counterpart-interests" class="block font-semibold mb-1">Primary Interests:</label>
                        <p id="counterpart-interests-text" class="text-sm text-slate-600 p-3 bg-slate-50 rounded-md"></p>
                    </div>
                </div>
            </div>

            <!-- Negotiation Phase -->
            <div id="negotiation-phase" class="p-6 rounded-lg shadow-md bg-white">
                <h2 class="text-xl font-bold mb-4 border-b pb-2">Negotiation</h2>
                <div id="negotiation-log" class="h-64 overflow-y-auto p-4 mb-4 bg-slate-50 rounded-md border">
                    <!-- Log entries will be added here -->
                </div>
                <div id="player-options" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Option buttons will be added here -->
                </div>
            </div>
            <button id="back-to-menu" class="w-full mt-6 text-center btn bg-slate-500 text-white font-bold py-2 px-4 rounded-lg">Back to Main Menu</button>
        </div>

        <!-- Outcome Screen -->
        <div id="outcome-screen" class="hidden text-center p-8 rounded-lg shadow-lg bg-white">
            <h2 id="outcome-title" class="text-3xl font-bold mb-4"></h2>
            <p id="outcome-summary" class="text-lg mb-6"></p>
            <p id="points-awarded" class="text-2xl font-bold mb-6 text-blue-600"></p>
            <div class="p-6 rounded-lg bg-gray-50 border mb-6">
                <h3 class="text-xl font-bold mb-3 text-gray-800">Debrief & Analysis</h3>
                <p id="outcome-debrief" class="text-left text-gray-600"></p>
            </div>
            <button id="play-again" class="btn bg-blue-500 text-white font-bold py-3 px-6 rounded-lg">Continue</button>
        </div>

    </div>

    <script>
        // --- DATA ---
        const scenarios = [
             {
                id: 'job_interview',
                title: 'The Job Interview',
                costToUnlock: 0,
                context: "You're in the final round of interviews for your dream job. The interviewer, Ms. Chen, is known to be very sharp. This isn't about salary yet; it's about proving you are the best candidate.",
                goal: "Impress the interviewer enough to secure a job offer, while confidently establishing your value.",
                player: {
                    batna: "Continue your job search; you have other promising leads but no firm offers.",
                    zopa: { walkaway: "Not getting a job offer.", target: "Getting a job offer and being seen as the top candidate." }
                },
                counterpart: {
                    name: "Ms. Chen, the Hiring Director",
                    batna: "Hire one of the other two final candidates.",
                    interests: "Hiring someone who is competent, confident (but not arrogant), and a good cultural fit. Avoiding a bad hire is her primary goal."
                },
                negotiationTree: {
                    start: {
                        prompt: "Ms. Chen starts the interview. After some introductions, she asks, 'So, tell me about your biggest weakness.'",
                        options: [
                            { text: "Give a clich√© answer: 'I'm a perfectionist' or 'I work too hard.'", outcome: 'bad_weakness_cliche' },
                            { text: "Name a genuine, but manageable, weakness and explain how you're working on it.", next: 'real_weakness' },
                            { text: "Say you don't have any weaknesses.", outcome: 'bad_weakness_arrogant' }
                        ]
                    },
                    real_weakness: {
                        response: "Ms. Chen nods, appreciating the honesty. 'Thank you for that. Now, let's talk salary. What are your expectations?' It's early to discuss salary, which can be a trap.",
                        options: [
                            { text: "Give a specific, high number to anchor the negotiation.", outcome: 'ok_interview_anchor' },
                            { text: "Give a wide salary range.", outcome: 'bad_interview_range' },
                            { text: "Defer the question: 'I'm more focused on finding the right fit right now. I'm sure we can agree on a fair number if we both feel it's a good match.'", next: 'defer_salary' }
                        ]
                    },
                    defer_salary: {
                        response: "Ms. Chen smiles slightly. 'A very diplomatic answer.' The interview continues positively. At the end, she says, 'This has been very productive. We'll be in touch soon.' A week later, you receive a strong job offer.",
                        options: [
                            { text: "Excellent!", outcome: 'excellent_interview' }
                        ]
                    },
                    outcomes: {
                        bad_weakness_cliche: { title: "Offer Unlikely", summary: "Your clich√© answer made you seem unoriginal and unprepared. The rest of the interview felt generic.", points: 10, debrief: "This common answer signals a lack of self-awareness. Interviewers hear it all the time. It's a missed opportunity to show thoughtfulness and a growth mindset." },
                        bad_weakness_arrogant: { title: "Interview Over", summary: "Claiming to have no weaknesses came across as incredibly arrogant and lacking self-awareness. The interview ended shortly after.", points: 0, debrief: "This is a major red flag for any interviewer. It shows a lack of humility and an inability to learn and grow, which are critical traits for any employee." },
                        bad_interview_range: { title: "Low Offer Received", summary: "You gave a wide range, and a week later they offered you a salary at the very bottom of that range.", points: 40, debrief: "When you provide a range, the other party will almost always anchor to the end that is most favorable to them. You negotiated against yourself before the negotiation even began." },
                        ok_interview_anchor: { title: "A Decent Offer", summary: "You anchored high, which was risky. They came back with a decent offer, but it felt like you were focused only on money from the start.", points: 60, debrief: "Anchoring high can work, but bringing it up so early can frame you as being primarily money-motivated. Deferring the conversation allows you to build more value and rapport before discussing numbers." },
                        excellent_interview: { title: "Strong Offer Received!", summary: "You navigated the interview perfectly, showing honesty and strategic thinking. You receive a very strong offer.", points: 100, debrief: "A masterful performance. You answered the weakness question honestly, which builds trust. You also correctly identified that discussing salary too early is a trap and skillfully deferred, keeping the focus on value and fit. This puts you in the strongest possible position for the upcoming salary negotiation." }
                    }
                }
            },
            {
                id: 'roommate_conflict',
                title: 'The Roommate Conflict',
                costToUnlock: 50,
                context: "You share an apartment with your roommate, Alex, who you are also friends with. For the past month, Alex has consistently left dirty dishes in the sink for days at a time, making the kitchen unpleasant.",
                goal: "Get Alex to clean their dishes promptly without creating a hostile living environment or damaging your friendship.",
                player: {
                    batna: "Tolerate the mess until the lease is up in 6 months, then find a new apartment.",
                    zopa: { walkaway: "The situation remaining exactly the same.", target: "A clear agreement where dishes are washed within 24 hours." }
                },
                counterpart: {
                    name: "Alex, your Roommate",
                    batna: "Continue their behavior, hoping you get used to it or do the dishes for them.",
                    interests: "Avoiding chores and conflict. Maintaining a friendly, low-stress home environment."
                },
                negotiationTree: {
                    start: {
                        prompt: "The sink is full of Alex's dirty dishes again. What do you do?",
                        options: [
                            { text: "Say nothing and just wash their dishes for them.", outcome: 'bad_roommate_passive' },
                            { text: "Leave a sarcastic, passive-aggressive note on the fridge.", next: 'note' },
                            { text: "Wait until you're both relaxing and calmly bring up the issue.", next: 'calm_talk' },
                            { text: "Pile their dirty dishes in front of their bedroom door.", outcome: 'bad_roommate_aggressive' }
                        ]
                    },
                    note: {
                        response: "The next day, the dishes are done, but Alex seems distant and is avoiding you. The atmosphere in the apartment is now tense.",
                        options: [
                            { text: "Pretend nothing happened and hope it blows over.", outcome: 'ok_roommate_tense' },
                            { text: "Apologize for the note and ask to talk properly.", next: 'calm_talk' },
                        ]
                    },
                    calm_talk: {
                        response: "You bring it up calmly. Alex looks embarrassed. 'Oh man, you're right. I'm sorry, I've just been so swamped with work lately, I keep forgetting.'",
                        options: [
                            { text: "Demand they do better from now on.", outcome: 'ok_roommate_demand' },
                            { text: "Suggest a simple house rule, like 'no dishes in the sink overnight'.", next: 'suggest_rule' },
                            { text: "Offer a trade: 'If you handle the dishes, I'll always take out the trash.'", next: 'suggest_trade' }
                        ]
                    },
                    suggest_rule: {
                        response: "Alex nods. 'Yeah, that's fair. I can definitely do that. Sorry again for being a slob.'",
                        options: [
                           { text: "Thank them and consider the matter resolved.", outcome: 'good_roommate' }
                        ]
                    },
                    suggest_trade: {
                        response: "Alex's face lights up. 'Really? I hate taking out the trash. That's a deal! I'll keep the sink spotless.'",
                        options: [
                           { text: "Shake on it. You've found a creative solution.", outcome: 'excellent_roommate' }
                        ]
                    },
                    outcomes: {
                        bad_roommate_passive: { title: "Problem Unsolved", summary: "You washed the dishes. Two days later, the sink is full again.", points: 0, debrief: "By avoiding the conflict entirely, you have set a precedent. Your counterpart now assumes you will solve the problem for them. This inaction has guaranteed the negative behavior will continue." },
                        bad_roommate_aggressive: { title: "Open Warfare", summary: "Alex was furious about the dishes by their door. You had a huge fight and now you're not speaking.", points: -25, debrief: "You chose a highly aggressive, zero-sum tactic. While it addressed the symptom (dishes), it destroyed the relationship, which was a key interest. The negotiation failed because the outcome is worse for both of you than the original problem." },
                        ok_roommate_tense: { title: "Temporary Fix, Tense Household", summary: "The dishes are done, for now, but the friendship is strained due to your passive-aggressive approach.", points: 40, debrief: "You got a result, but at the cost of trust and goodwill. Passive-aggression creates resentment and is a poor long-term strategy in relationship-based negotiations." },
                        ok_roommate_demand: { title: "A Reluctant Agreement", summary: "Alex agreed to do better, but your demanding tone made the conversation feel like a lecture.", points: 60, debrief: "You achieved your goal, but didn't handle the relationship aspect well. A more collaborative framing would have strengthened your friendship instead of making it feel like a parent-child dynamic." },
                        good_roommate: { title: "Problem Solved", summary: "You talked it out and agreed on a simple, fair rule. The friendship is intact.", points: 80, debrief: "This is a great, mature outcome. You clearly and respectfully stated your needs, listened to their perspective, and collaboratively came up with a simple solution that works for both of you." },
                        excellent_roommate: { title: "Partnership Formed!", summary: "You traded chores, turning a point of conflict into a mutually beneficial deal.", points: 100, debrief: "Masterful negotiation. You didn't just solve the problem, you 'expanded the pie' by finding an unrelated trade-off. Alex values not taking out the trash more than they dislike doing dishes. You found a hidden, high-value trade that cost you nothing." }
                    }
                }
            },
            {
                id: 'flawed_purchase',
                title: 'The Flawed Purchase',
                costToUnlock: 75,
                context: "You bought a $300 jacket a month ago. You've worn it twice, and now the zipper has broken. The store's policy is a strict 14-day return for a full refund. You are now at the customer service desk with the manager.",
                goal: "Get a fair resolution for your faulty product, such as a refund, replacement, or store credit.",
                player: {
                    batna: "Leave with the broken jacket, losing $300. Or, dispute the charge with your credit card company (hassle, may not work).",
                    zopa: { walkaway: "Leaving with nothing.", target: "A full $300 refund." }
                },
                counterpart: {
                    name: "The Store Manager",
                    batna: "Refuse your request and stick to the written policy.",
                    interests: "Following company policy. Avoiding conflict with customers. Keeping their store's sales numbers up (store credit is better for them than a refund)."
                },
                negotiationTree: {
                    start: {
                        prompt: "The manager looks at your receipt and says, 'I see you bought this 32 days ago. I'm sorry, but our return policy is 14 days for a refund. There's nothing I can do.'",
                        options: [
                            { text: "Demand to speak to their boss and threaten to leave a bad review online.", outcome: 'bad_purchase_threat' },
                            { text: "Sigh and walk away with the broken jacket.", outcome: 'bad_purchase_giveup' },
                            { text: "Acknowledge the policy, but frame it as a quality issue, not a return.", next: 'quality_issue' },
                            { text: "Ask for an exception as a gesture of goodwill.", next: 'ask_goodwill' }
                        ]
                    },
                    quality_issue: {
                        response: "You say, 'I understand the return policy, but this isn't a return. This is a faulty product. A $300 jacket shouldn't break after two wears.' The manager's expression softens slightly. 'I see your point.'",
                        options: [
                            { text: "Press for a full cash refund now.", next: 'press_refund' },
                            { text: "Suggest an exchange for an identical jacket.", next: 'suggest_exchange' },
                            { text: "Ask what solutions they can offer for a defective item.", next: 'ask_solutions' }
                        ]
                    },
                    ask_goodwill: {
                        response: "The manager looks sympathetic but firm. 'I wish I could, but the policy is very strict. My hands are tied on refunds after 14 days.'",
                        options: [
                            { text: "Re-frame it as a product quality issue.", next: 'quality_issue' },
                            { text: "Accept defeat and leave.", outcome: 'bad_purchase_giveup' }
                        ]
                    },
                    press_refund: {
                        response: "The manager hesitates. 'A cash refund is against the rules. The best I can do is offer you the full amount in store credit.'",
                        options: [
                            { text: "Accept the store credit.", outcome: 'good_purchase' },
                            { text: "Refuse the store credit and insist on a cash refund.", outcome: 'ok_purchase' }
                        ]
                    },
                    suggest_exchange: {
                        response: "The manager nods. 'A direct exchange for the same item due to a defect is something I can do.' He finds a new jacket for you.",
                        options: [
                            { text: "Accept the new jacket.", outcome: 'excellent_purchase_exchange' }
                        ]
                    },
                    ask_solutions: {
                        response: "The manager thinks for a moment. 'Because it's a quality issue, I have some flexibility. I can offer you an identical replacement, or I can give you the full $300 in store credit.'",
                        options: [
                            { text: "Take the replacement jacket.", outcome: 'excellent_purchase_exchange' },
                            { text: "Take the store credit.", outcome: 'good_purchase' }
                        ]
                    },
                    outcomes: {
                        bad_purchase_threat: { title: "Request Denied", summary: "Your aggressive tone made the manager defensive, and they refused to help you, pointing to the policy.", points: 0, debrief: "Threats and aggression are low-power moves that often backfire. You gave the manager a reason to dig in and follow the policy to the letter rather than a reason to help you." },
                        bad_purchase_giveup: { title: "Total Loss", summary: "You accepted their first 'no' and left with a broken jacket.", points: 0, debrief: "You gave up without even attempting a negotiation. You accepted your worst-case scenario without exploring any alternatives." },
                        ok_purchase: { title: "A Tense Refund", summary: "After a lot of arguing, the manager reluctantly gave you a cash refund, but the experience was unpleasant.", points: 60, debrief: "You got your ideal outcome, but at the cost of goodwill. A more collaborative approach might have gotten the same result without the friction." },
                        good_purchase: { title: "Store Credit Issued", summary: "You successfully negotiated for $300 in store credit.", points: 80, debrief: "A great outcome. You successfully navigated the store's policy by reframing the problem. This solution works for you and is even better for the manager, as the money stays in their store." },
                        excellent_purchase_exchange: { title: "Replacement Secured", summary: "By focusing on the product's defect, you secured a brand new jacket.", points: 100, debrief: "A perfect negotiation. You correctly identified that their 'no' was about the return policy, not about helping a customer with a faulty item. By reframing the issue, you made it easy for the manager to help you within their rules, getting exactly what you originally wanted." }
                    }
                }
            },
            {
                id: 'unwanted_gift',
                title: 'The Unwanted Gift',
                costToUnlock: 100,
                context: "It's your birthday, and your aunt gave you a fancy, $150 coffee machine. The problem is, you already have one you love. You don't have a gift receipt.",
                goal: "Try to get store credit or an exchange for the item without a receipt, knowing the store policy is against it.",
                player: {
                    batna: "Keep the duplicate coffee machine or re-gift it later.",
                    zopa: { walkaway: "Leaving with the duplicate machine.", target: "Getting full store credit for $150." }
                },
                counterpart: {
                    name: "A Retail Associate",
                    batna: "Politely refuse your request, citing store policy.",
                    interests: "Following the rules to avoid getting in trouble. Processing customers quickly. Not escalating issues to their manager."
                },
                negotiationTree: {
                    start: {
                        prompt: "You approach the service desk. The associate scans the item and says, 'Do you have a receipt?' You explain it was a gift and you don't. They reply, 'I'm sorry, without a receipt, we can't do any returns or exchanges.'",
                        options: [
                            { text: "Argue with them about how it's a terrible policy.", outcome: 'bad_gift_argue' },
                            { text: "Thank them and leave with the coffee machine.", outcome: 'bad_gift_giveup' },
                            { text: "Ask to speak to a manager.", next: 'ask_manager' },
                            { text: "Ask, 'Is there anything at all you can do? I'm a loyal customer.'", next: 'ask_loyalty' }
                        ]
                    },
                    ask_manager: {
                        response: "The associate looks annoyed, but calls the manager. The manager arrives and repeats the policy. 'Our policy is firm on this to prevent fraud.'",
                        options: [
                            { text: "Say 'Fine, I'll just take my business elsewhere from now on.'", outcome: 'bad_gift_argue' },
                            { text: "Politely explain the situation and ask if they can make a one-time exception.", next: 'manager_exception' }
                        ]
                    },
                    ask_loyalty: {
                        response: "The associate softens a little. 'Let me see... The best I can do without a receipt is offer you the lowest sale price for this item in the last 60 days, which is $90 in store credit.'",
                        options: [
                            { text: "Accept the $90 store credit.", outcome: 'ok_gift' },
                            { text: "Decline and ask for a manager.", next: 'ask_manager' }
                        ]
                    },
                    manager_exception: {
                        response: "The manager considers you. 'You've been polite. I can see the item is unopened. I can't give you cash, but I can make an exception and issue a store credit for the full $150.'",
                        options: [
                            { text: "Thank them profusely and accept the store credit.", outcome: 'excellent_gift' }
                        ]
                    },
                    outcomes: {
                        bad_gift_argue: { title: "Request Denied", summary: "Your confrontational attitude made the staff unwilling to help. You left with nothing.", points: 0, debrief: "Being aggressive with frontline staff rarely works. They are bound by rules, and creating conflict removes any desire they might have had to find a creative solution or escalate to someone who could help." },
                        bad_gift_giveup: { title: "No Resolution", summary: "You accepted the first 'no' and left with the duplicate coffee machine.", points: 10, debrief: "You accepted your BATNA without any negotiation. While not a disaster, it was a missed opportunity. A simple, polite question could have opened other doors." },
                        ok_gift: { title: "Partial Credit", summary: "You successfully negotiated for $90 in store credit.", points: 70, debrief: "A good outcome! You were polite and successfully negotiated a partial win. You didn't get the full value, but you turned a 'no' into a 'yes' by being reasonable and appealing to their sense of service." },
                        excellent_gift: { title: "Full Store Credit!", summary: "By escalating politely and calmly explaining the situation, you got the manager to make an exception.", points: 100, debrief: "Perfect execution. You understood the associate's constraints, politely escalated to someone with more authority, and then calmly stated your case. This empowered the manager to use their discretion to help you, resulting in the best possible outcome." }
                    }
                }
            },
            {
                id: 'car_dealership',
                title: 'The Car Dealership',
                costToUnlock: 175,
                context: "You've found a used car you like at a dealership. The sticker price is $18,500. You've done your research and know the car's market value is closer to $16,000.",
                goal: "Negotiate a final price as close to the market value as possible and avoid unnecessary add-ons.",
                player: {
                    batna: "Walk away and buy a similar car from a private seller for around $16,500.",
                    zopa: { walkaway: "A final price over $17,000.", target: "$16,000" }
                },
                counterpart: {
                    name: "A Car Salesman",
                    batna: "Sell the car to another buyer.",
                    interests: "Maximizing the profit on this single sale. Hitting their monthly sales quota. Selling high-margin add-ons (warranties, coatings)."
                },
                negotiationTree: {
                    start: {
                        prompt: "After a test drive, you sit down with the salesman. He says, 'So, you love the car! It's priced to sell at $18,500. We can get the financing paperwork started right now.'",
                        options: [
                            { text: "Agree to the $18,500 price.", outcome: 'bad_car_accept' },
                            { text: "Make a very low offer of $14,000.", next: 'lowball' },
                            { text: "Say, 'The car is great, but the price is a bit high based on my research. My first offer is $16,000.'", next: 'fair_offer' },
                            { text: "Ask, 'What's the best out-the-door price you can give me?'", next: 'ask_best_price' }
                        ]
                    },
                    lowball: {
                        response: "The salesman laughs. 'Fourteen? I can't do that. That's way below our cost. I need you to be realistic.' He seems annoyed by your opening.",
                        options: [
                            { text: "Immediately jump to $16,000.", next: 'fair_offer' },
                            { text: "Hold firm at $14,000.", outcome: 'bad_car_insult' }
                        ]
                    },
                    ask_best_price: {
                        response: "The salesman says, 'We don't have a lot of wiggle room. Maybe I can knock a few hundred off for you. Say, $18,200?'",
                        options: [
                            { text: "Accept $18,200.", outcome: 'bad_car_accept' },
                            { text: "Make a counter-offer of $16,000.", next: 'fair_offer' }
                        ]
                    },
                    fair_offer: {
                        response: "The salesman sighs and goes to 'talk to his manager.' He comes back and says, 'This is tough. My manager will kill me, but we can do $17,500. That's our rock-bottom price.'",
                        options: [
                            { text: "Accept the $17,500 price.", outcome: 'ok_car' },
                            { text: "Say, 'My best is $16,500. If you can do that, we have a deal right now.'", next: 'final_offer' },
                            { text: "Get up and start to walk away.", next: 'walk_away' }
                        ]
                    },
                    final_offer: {
                        response: "He hesitates, then extends a hand. 'You drive a hard bargain. Okay, $16,500 it is. Let's write it up.'",
                        options: [
                            { text: "Great!", outcome: 'excellent_car' }
                        ]
                    },
                    walk_away: {
                        response: "You stand up and start to leave. As you reach the door, the salesman calls out, 'Wait! Hold on! Let me talk to my manager one more time.' He comes back, looking defeated. 'Okay... fine. We can do $16,800. But that's it.'",
                        options: [
                            { text: "Accept the $16,800 deal.", outcome: 'good_car' },
                            { text: "Insist on $16,500.", outcome: 'bad_car_risky' }
                        ]
                    },
                    outcomes: {
                        bad_car_accept: { title: "You Overpaid", summary: "You paid the sticker price or very close to it.", points: 0, debrief: "You accepted the opening offer in a negotiation that is famously distributive. The sticker price is an anchor, and you are always expected to negotiate it down. You left thousands on the table." },
                        bad_car_insult: { title: "Deal Failed", summary: "Your lowball offer was seen as unserious, and the salesman refused to negotiate further.", points: 10, debrief: "While a low anchor can be effective, an offer that is perceived as insulting can shut down the negotiation entirely. It signaled you weren't a serious buyer." },
                        bad_car_risky: { title: "Deal Failed", summary: "Your walk-away tactic worked, but you got greedy and pushed too hard at the end. They let you leave.", points: 40, debrief: "The walk-away is a powerful but risky move. It often gets you the counterpart's true final offer. When you rejected that final offer, you broke their trust and they had no choice but to let you go." },
                        ok_car: { title: "A Decent Deal", summary: "You negotiated the price down to $17,500.", points: 60, debrief: "You successfully negotiated, but you accepted their first counter-offer. In these negotiations, there is almost always more room. You could have pushed further." },
                        good_car: { title: "A Good Deal", summary: "By walking away, you negotiated the price down to $16,800.", points: 80, debrief: "A very strong outcome. You correctly used the walk-away tactic to get them to reveal a better offer than what they presented as their 'rock-bottom' price. You played the game well." },
                        excellent_car: { title: "An Excellent Deal!", summary: "You made a firm, fair final offer and got the car for $16,500.", points: 100, debrief: "A masterful negotiation. You did your research, made a fair and confident opening offer, and presented your final counter as a clear, take-it-or-leave-it proposition. This showed you were a serious, informed buyer and got you a price very close to your BATNA." }
                    }
                }
            },
            {
                id: 'raise_request',
                title: 'Asking for a Raise',
                costToUnlock: 225,
                context: "You've been a top performer at your company for over a year and feel you are underpaid. You've scheduled a meeting with your boss to discuss your compensation.",
                goal: "Secure a significant raise that reflects your contributions.",
                player: {
                    batna: "Start looking for a new job (a slow and uncertain process).",
                    zopa: { walkaway: "A raise less than 3%.", target: "A raise of 10% or more." }
                },
                counterpart: {
                    name: "Your Boss",
                    batna: "Decline your request and risk you becoming demotivated or leaving.",
                    interests: "Retaining a top performer. Staying within their departmental budget. Following HR compensation guidelines."
                },
                negotiationTree: {
                    start: {
                        prompt: "You sit down with your boss. You say you want to discuss your compensation. Your boss says, 'Okay, what's on your mind?'",
                        options: [
                            { text: "Say, 'I want a 15% raise.'", next: 'demand_raise' },
                            { text: "Present a detailed list of your accomplishments and contributions over the past year.", next: 'present_case' },
                            { text: "Hint that you have other job offers.", outcome: 'bad_raise_threat' },
                            { text: "Ask, 'What is the process for salary reviews?'", next: 'ask_process' }
                        ]
                    },
                    demand_raise: {
                        response: "Your boss looks taken aback. 'Fifteen percent is a very large increase. I don't have the budget for that. The standard is 3-4%.'",
                        options: [
                            { text: "Accept the 3% raise.", outcome: 'bad_raise_accept' },
                            { text: "Present your list of accomplishments to justify the higher number.", next: 'present_case_after' }
                        ]
                    },
                    ask_process: {
                        response: "Your boss explains the annual review cycle. 'We can discuss your performance now, and I can submit a recommendation for the next cycle, but the decisions are made by HR and finance based on performance tiers.'",
                        options: [
                            { text: "Okay, then let me show you my performance from this year...", next: 'present_case' },
                            { text: "That sounds like a 'no'. I guess I'll wait.", outcome: 'bad_raise_giveup' }
                        ]
                    },
                    present_case: {
                        response: "You walk your boss through a document detailing your successes, completed projects, and positive impact on the team. They are visibly impressed. 'This is... very thorough. You've clearly had an excellent year.'",
                        options: [
                            { text: "Based on this, I believe a 12% raise is appropriate.", next: 'propose_raise' },
                            { text: "Ask 'What level of compensation increase does this level of performance typically warrant?'", next: 'ask_warrant' }
                        ]
                    },
                    present_case_after: {
                         response: "Your boss reviews your list. 'This is great work, I agree. But as I said, 15% is just not possible. Because of your performance, I can probably push for 6%.'",
                        options: [
                            { text: "Accept the 6% raise.", outcome: 'ok_raise' }
                        ]
                    },
                    propose_raise: {
                         response: "Your boss considers your 12% proposal. 'That's still high, but given the case you've laid out... I can't promise anything, but I will take this to HR and fight for you. I think I can get you at least 8%.'",
                        options: [
                            { text: "Accept the 8% raise.", outcome: 'good_raise' }
                        ]
                    },
                    ask_warrant: {
                        response: "Your boss thinks. 'You're putting me on the spot... but you're right to ask. For this level of contribution, you should be in our top performance tier. I will personally advocate to get you the maximum possible raise, which should be around 10%.'",
                        options: [
                            { text: "Thank them for their advocacy. This is a great outcome.", outcome: 'excellent_raise' }
                        ]
                    },
                    outcomes: {
                        bad_raise_threat: { title: "Relationship Damaged", summary: "Hinting at other offers came across as a threat. Your boss is now questioning your loyalty.", points: -25, debrief: "This turns a collaborative discussion into a hostile one. Unless you have a firm offer and are ready to walk (your BATNA), this is a bluff that can easily backfire and damage the trust with your manager." },
                        bad_raise_accept: { title: "A Minimal Raise", summary: "You accepted the standard 3% raise after your initial demand was rejected.", points: 20, debrief: "You anchored high but had no follow-up strategy. By not presenting your case first, you gave your boss no reason to go beyond the standard offering." },
                        bad_raise_giveup: { title: "No Raise", summary: "You accepted the bureaucratic process as the final word and gave up.", points: 0, debrief: "Understanding the process is good, but it shouldn't be the end of the conversation. You should have used it as a starting point to make your case for why you deserve a special exception." },
                        ok_raise: { title: "A Decent Raise", summary: "You got a 6% raise, double the standard.", points: 60, debrief: "A good outcome. Your performance justified a better-than-average raise. However, by demanding a number before showing your value, you put your boss on the defensive and may have limited the potential." },
                        good_raise: { title: "A Strong Raise", summary: "You made your case and secured an 8% raise.", points: 80, debrief: "A great result. You successfully tied your request to your proven value, giving your boss the ammunition they needed to fight for you. This is a solid, evidence-based negotiation strategy." },
                        excellent_raise: { title: "An Excellent Raise!", summary: "By making your boss an ally, you secured their advocacy for a 10% raise.", points: 100, debrief: "Masterful. Instead of making a demand, you presented evidence and asked your boss to be your partner. This made them feel respected and empowered them to become your champion in discussions with HR. You didn't just ask for a raise; you created an advocate." }
                    }
                }
            },
            {
                id: 'landlord_negotiation',
                title: 'The Landlord Negotiation',
                costToUnlock: 150,
                context: "Your one-year lease is up for renewal. Your landlord has just informed you they are increasing your rent by 15%, which is much higher than the average for your area.",
                goal: "Negotiate a more reasonable rent increase, or gain other concessions (like repairs or upgrades) to justify the new price.",
                player: {
                    batna: "Move to a different apartment. This would be a major hassle and have significant one-time costs.",
                    zopa: { walkaway: "A rent increase above 8%.", target: "An increase of 3-5% OR the current rent with a longer lease." }
                },
                counterpart: {
                    name: "Your Landlord",
                    batna: "Find a new tenant, which costs them time and money (lost rent, cleaning, advertising).",
                    interests: "Maximizing their rental income. Keeping good, reliable tenants who pay on time and don't cause problems. Minimizing their own maintenance effort."
                },
                negotiationTree: {
                    start: {
                        prompt: "Your landlord emails you: 'Hi, I hope you're enjoying the apartment. For your lease renewal, the new monthly rent will be $2,300 (a 15% increase).' How do you respond?",
                        options: [
                            { text: "Immediately agree to the new rent.", outcome: 'bad_landlord_accept' },
                            { text: "Email back saying the increase is unacceptable and you will be moving out.", outcome: 'bad_landlord_threaten' },
                            { text: "Respond by highlighting your history as a good tenant and asking if the rate is negotiable.", next: 'ask_negotiable' },
                            { text: "Counter with a lower increase (e.g., 3%) and cite market data for your area.", next: 'counter_data' }
                        ]
                    },
                    ask_negotiable: {
                        response: "The landlord replies, 'I appreciate you being a good tenant. The market has gone up significantly, which is why the rent has increased. What did you have in mind?'",
                        options: [
                            { text: "Propose a 5% increase and offer to sign a 2-year lease for stability.", next: 'propose_longterm' },
                            { text: "Ask if they would keep the rent the same if you handled minor repairs yourself.", next: 'propose_repairs' },
                            { text: "Say 'something lower' without giving a number.", outcome: 'ok_landlord_vague' }
                        ]
                    },
                    counter_data: {
                        response: "The landlord seems a bit defensive. 'I've seen different data. My price is fair. The best I can do is a 12% increase.'",
                        options: [
                            { text: "Accept the 12% increase.", outcome: 'bad_landlord_accept' },
                            { text: "Pivot to a longer lease term for a better rate.", next: 'propose_longterm' },
                            { text: "Threaten to report them for a minor code violation you noticed.", outcome: 'bad_landlord_nuke' }
                        ]
                    },
                    propose_longterm: {
                        response: "The landlord is interested. 'A 2-year lease saves me the risk of a vacancy. That's valuable. I can agree to a 5% increase if you sign for two years.'",
                        options: [
                            { text: "Accept the deal.", outcome: 'excellent_landlord' }
                        ]
                    },
                    propose_repairs: {
                        response: "The landlord is very interested. 'That's an interesting idea. Not having to call a plumber for small leaks would save me a lot of hassle. Okay, keep the rent the same, and just text me if anything major breaks. Deal.'",
                        options: [
                            { text: "Agree to the deal.", outcome: 'excellent_landlord_alt' }
                        ]
                    },
                    outcomes: {
                        bad_landlord_accept: { title: "You Overpaid", summary: "You accepted a huge rent increase without any negotiation.", points: 0, debrief: "Rent increases are almost always negotiable, especially for a good tenant. Your landlord's BATNA (finding a new tenant) has costs and risks. You failed to leverage your position." },
                        bad_landlord_threaten: { title: "Moving Out", summary: "You immediately invoked your BATNA. Your landlord accepted your notice to vacate.", points: 10, debrief: "You played chicken and lost. While moving was your alternative, you used it as an opening threat rather than a last resort, shutting down any chance of finding a better solution." },
                        bad_landlord_nuke: { title: "Eviction Notice", summary: "Threatening the landlord created an extremely hostile relationship. They have refused to renew your lease under any circumstances.", points: -50, debrief: "This is a scorched-earth tactic. It permanently destroyed the relationship and forced you into your BATNA under the worst possible terms. Never create a conflict you can't win." },
                        ok_landlord_vague: { title: "A Small Reduction", summary: "After some back and forth, you got the increase reduced to 10%.", points: 50, debrief: "You successfully negotiated a better outcome, which is a win. However, by not offering creative solutions or strong justifications, you settled for a simple compromise instead of the best possible deal." },
                        excellent_landlord: { title: "A Great Deal!", summary: "You secured a much lower 5% increase in exchange for signing a longer lease.", points: 100, debrief: "Masterful. You identified your landlord's hidden interest (avoiding vacancies) and offered something that was low-cost for you (a longer commitment) but high-value for them. This is a classic integrative bargaining win." },
                        excellent_landlord_alt: { title: "A Creative Deal!", summary: "You kept your rent the same by agreeing to handle minor repairs.", points: 125, debrief: "An absolutely brilliant negotiation. You found a non-monetary trade that perfectly suited both your interests. You save money, and your landlord saves time and hassle‚Äîa true win-win that expands the pie." }
                    }
                }
            },
            {
                id: 'family_favor',
                title: 'The Family Favor',
                costToUnlock: 200,
                context: "You need to borrow your older sibling's car for the weekend for a trip with friends. Your sibling, Taylor, is protective of their car and rarely lends it out.",
                goal: "Convince Taylor to lend you the car for the weekend.",
                player: {
                    batna: "Rent a car, which is expensive, or cancel the trip.",
                    zopa: { walkaway: "Not getting the car.", target: "Getting the car for the weekend with no strings attached." }
                },
                counterpart: {
                    name: "Taylor, your Sibling",
                    batna: "Say no.",
                    interests: "Keeping their car safe and clean. Feeling respected and appreciated. Not feeling taken for granted."
                },
                negotiationTree: {
                    start: {
                        prompt: "You call Taylor. 'Hey, can I borrow your car this weekend?' Taylor hesitates. 'Uh, I don't know... I'm kind of worried about it getting damaged.'",
                        options: [
                            { text: "Guilt trip them: 'Come on, we're family! You should help me out!'", outcome: 'bad_favor_guilt' },
                            { text: "Address their concern directly: 'I totally get that. I'll be extra careful.'", next: 'address_concern' },
                            { text: "Try to minimize their concern: 'It's just a car, don't worry about it.'", outcome: 'bad_favor_minimize' },
                            { text: "Immediately offer to pay them for it.", next: 'offer_payment' }
                        ]
                    },
                    address_concern: {
                        response: "'I appreciate you saying that,' Taylor says, sounding a bit more relaxed. 'What's the plan for the trip?'",
                        options: [
                            { text: "Explain the trip and offer to fill up the tank before you return it.", next: 'offer_gas' },
                            { text: "Be vague: 'Oh, just hanging out with friends.'", outcome: 'bad_favor_vague' }
                        ]
                    },
                    offer_payment: {
                        response: "Taylor sounds a little offended. 'I don't want your money, that's not the point. I'm just worried about the car itself.'",
                        options: [
                            { text: "Apologize and address their actual concern about safety.", next: 'address_concern' },
                            { text: "Insist on paying them.", outcome: 'bad_favor_minimize' }
                        ]
                    },
                    offer_gas: {
                        response: "'Okay, that seems fair,' Taylor says. 'Just one more thing - can you make sure it's cleaned inside and out before you bring it back?'",
                        options: [
                            { text: "Agree to the terms.", outcome: 'good_favor' },
                            { text: "Complain that cleaning it is too much work.", outcome: 'bad_favor_complain' }
                        ]
                    },
                    outcomes: {
                        bad_favor_guilt: { title: "Request Denied", summary: "Taylor got annoyed and said no. The conversation ended on a sour note.", points: 0, debrief: "Guilt trips are a form of emotional manipulation. This tactic damages trust and relationships, making people less likely to cooperate. You failed to respect their interests." },
                        bad_favor_minimize: { title: "Request Denied", summary: "By dismissing their concerns, you made Taylor feel disrespected, and they refused.", points: 0, debrief: "You failed to acknowledge your counterpart's primary interest (the safety of their car). By minimizing it, you signaled that you wouldn't be a responsible borrower." },
                        bad_favor_vague: { title: "Request Denied", summary: "Your vague answers made Taylor suspicious, and they said they weren't comfortable lending you the car.", points: 20, debrief: "In a negotiation based on trust, transparency is key. Your lack of specifics made it seem like you were hiding something, which increased their perceived risk." },
                        bad_favor_complain: { title: "A Reluctant 'Yes'", summary: "Taylor reluctantly agreed after you complained, but you can tell they're not happy about it.", points: 50, debrief: "You got the car, but you damaged the relationship by appearing ungrateful for the favor. This will make it much harder to ask for anything in the future." },
                        good_favor: { title: "Deal Made!", summary: "You got the car for the weekend after agreeing to some fair conditions.", points: 80, debrief: "A solid, respectful negotiation. You addressed their concerns, made a fair offer (gas), and agreed to a reasonable condition (cleaning). You both walk away feeling good about the arrangement." },
                        excellent_favor: { title: "Relationship Strengthened!", summary: "You got the car, and Taylor feels great about it because you also offered to do their laundry for a week.", points: 100, debrief: "This response is not yet implemented in the tree, but represents finding a creative, unrelated trade that is low-cost for you but high-value for them, strengthening the relationship." }
                    }
                }
            },
             {
                id: 'restaurant_bill',
                title: 'The Restaurant Bill',
                costToUnlock: 125,
                context: "You're at a nice restaurant for a special occasion. You ordered the $40 steak medium-rare, but it arrived well-done and tough. You ate some of it because you were hungry and didn't want to make a scene.",
                goal: "Get a resolution for the poorly cooked meal, such as having the item removed from the bill or receiving a discount.",
                player: {
                    batna: "Pay the full bill and leave unhappy.",
                    zopa: { walkaway: "Paying the full price for the steak.", target: "Getting the steak removed from the bill." }
                },
                counterpart: {
                    name: "Your Server / The Manager",
                    batna: "Insist you pay the full bill.",
                    interests: "Ensuring customer satisfaction and a positive review. Resolving issues quickly and discreetly. Not giving away free items unnecessarily."
                },
                negotiationTree: {
                    start: {
                        prompt: "The server brings the bill. The $40 steak is on it. What do you do?",
                        options: [
                            { text: "Say nothing and pay the full bill.", outcome: 'bad_bill_pay' },
                            { text: "Loudly complain that the steak was terrible and you refuse to pay for it.", outcome: 'bad_bill_scene' },
                            { text: "Politely get the server's attention and explain the issue with the steak.", next: 'polite_complaint' },
                            { text: "Pay the bill, but leave a very small tip and a bad review online later.", outcome: 'bad_bill_review' }
                        ]
                    },
                    polite_complaint: {
                        response: "The server looks concerned. 'Oh, I'm so sorry to hear that! You should have said something sooner. Since you've eaten part of it, I can't take it off the bill, but I can offer you a free dessert.'",
                        options: [
                            { text: "Accept the free dessert.", outcome: 'ok_bill' },
                            { text: "Decline the dessert and ask to speak to the manager.", next: 'ask_manager_bill' },
                            { text: "Say 'A free dessert isn't good enough for a $40 steak.'", next: 'reject_dessert' }
                        ]
                    },
                    ask_manager_bill: {
                        response: "The manager comes over. You politely explain the situation again. The manager says, 'I understand completely. I am so sorry about that. Of course we will remove the steak from your bill.'",
                        options: [
                            { text: "Thank the manager for their help.", outcome: 'good_bill' }
                        ]
                    },
                    reject_dessert: {
                        response: "The server looks flustered. They get the manager. The manager arrives, looking annoyed. 'Sir/Ma'am, we offered a resolution. At this point, I can take 10% off the steak, but that's it.'",
                        options: [
                            { text: "Accept the 10% discount.", outcome: 'ok_bill_tense' },
                            { text: "Continue to argue.", outcome: 'bad_bill_scene' }
                        ]
                    },
                    outcomes: {
                        bad_bill_pay: { title: "Dissatisfied Customer", summary: "You paid the full price for a meal you didn't enjoy.", points: 0, debrief: "You failed to advocate for yourself. While it can be uncomfortable to complain, legitimate issues should be addressed. You accepted your BATNA without even trying to negotiate." },
                        bad_bill_scene: { title: "A Tense Exit", summary: "You made a scene, got a small discount, and are now banned from the restaurant.", points: -25, debrief: "Aggression is a poor tactic. It puts the staff on the defensive and removes any desire to help you. You may have gotten a small financial win, but you destroyed the relationship and created an unpleasant experience for everyone." },
                        bad_bill_review: { title: "Delayed Revenge", summary: "You paid, but then left a bad review. The restaurant is unhappy, and you're still out $40.", points: 10, debrief: "This is a passive-aggressive approach. It doesn't solve your immediate problem (the cost of the bad meal) and only serves to punish the restaurant later. A direct, polite conversation is almost always more effective." },
                        ok_bill_tense: { title: "A Small Discount", summary: "After some unpleasantness, you got a 10% discount on the steak.", points: 40, debrief: "You got a minor concession, but your demanding tone made the interaction more difficult than it needed to be. A more collaborative approach would have likely yielded a better result." },
                        ok_bill: { title: "A Free Dessert", summary: "You got a free dessert to compensate for the steak.", points: 60, debrief: "A decent outcome. You successfully got a concession from the server. However, the value of the dessert is likely much less than the steak. Escalating politely to a manager might have resulted in a better outcome." },
                        good_bill: { title: "Steak Comped!", summary: "By politely but firmly escalating to a manager, you had the full price of the steak removed from your bill.", points: 100, debrief: "Excellent work. You were polite, clear, and understood when to escalate to someone with more authority to resolve the issue. You achieved your target outcome while maintaining a respectful tone." }
                    }
                }
            },
             {
                id: 'holiday_dinner',
                title: 'The Holiday Dinner',
                costToUnlock: 250,
                context: "You and your partner need to decide where to spend a major holiday. Your family hosts a large, loud gathering. Your partner's family has a small, quiet dinner. Both families live about the same distance away and expect you to be there.",
                goal: "Find a solution that makes both you and your partner feel happy and doesn't offend either family.",
                player: {
                    batna: "You and your partner stay home and spend the holiday alone, disappointing both families.",
                    zopa: { walkaway: "Going to one family's event and having your partner be miserable.", target: "A solution where everyone feels their needs were respected." }
                },
                counterpart: {
                    name: "Your Partner",
                    batna: "Agree to your plan but be resentful, or insist on their plan.",
                    interests: "Spending quality time with their family. Avoiding the stress of your large family gathering. Making you happy."
                },
                negotiationTree: {
                    start: {
                        prompt: "Your partner says, 'So, about the holiday... I was really hoping we could go to my parents' house this year. Your family's get-together is just so overwhelming for me.'",
                        options: [
                            { text: "Insist on going to your family's party because it's 'tradition'.", outcome: 'bad_holiday_insist' },
                            { text: "Say 'Okay, we'll go to your parents'.' (And be unhappy about it).", outcome: 'bad_holiday_capitulate' },
                            { text: "Acknowledge their feelings and ask, 'What part is most overwhelming? Let's figure this out together.'", next: 'ask_overwhelming' },
                            { text: "Suggest splitting the day: half at their family's, half at yours.", next: 'suggest_split' }
                        ]
                    },
                    ask_overwhelming: {
                        response: "Your partner seems relieved you're listening. 'It's mostly just how long it is, and how loud. I feel like I can't have a real conversation. I miss just quietly catching up with everyone.'",
                        options: [
                            { text: "Propose a time limit: 'What if we go to my family's, but only stay for 2 hours?'", outcome: 'good_holiday' },
                            { text: "Suggest hosting your own, small holiday dinner and inviting both families.", outcome: 'ok_holiday_host' }
                        ]
                    },
                    suggest_split: {
                        response: "Your partner looks stressed. 'That sounds even worse! We'd spend half the day in the car and rush through both visits. It feels like we'd lose either way.'",
                        options: [
                            { text: "Okay, bad idea. Let's find another way. What's most important to you about the day?", next: 'ask_overwhelming' },
                            { text: "Insist it's the only fair way.", outcome: 'bad_holiday_insist' }
                        ]
                    },
                    outcomes: {
                        bad_holiday_insist: { title: "A Resentful Holiday", summary: "You went to your family's party, but your partner was clearly unhappy the entire time. It caused a major fight.", points: 0, debrief: "You focused on your position (your family) instead of your shared interest (having a happy holiday together). This is a classic lose-lose outcome where you got what you wanted but damaged the relationship." },
                        bad_holiday_capitulate: { title: "A Resentful Holiday", summary: "You went to your partner's family dinner, but you were unhappy and it showed, making the day awkward for everyone.", points: 10, debrief: "Capitulating isn't a real agreement. While it avoids an argument, the unresolved resentment will likely cause bigger problems later. A good negotiation leads to an outcome both parties are happy with." },
                        ok_holiday_host: { title: "A Stressful Compromise", summary: "You hosted your own dinner. It was a logistical nightmare and didn't fully satisfy either family's traditions.", points: 50, debrief: "While a creative idea, this compromise created more work and stress for you without fully meeting anyone's interests. Sometimes the middle ground is the worst place to be." },
                        good_holiday: { title: "A Successful Compromise!", summary: "You agreed to go to your family's party for a shorter, defined period. Your partner felt heard and you still got to see your family.", points: 80, debrief: "A great outcome. You identified the specific problem (the duration and noise) and found a solution that addressed it directly. This allowed for a compromise that met everyone's core needs." },
                        excellent_holiday: { title: "An Excellent Long-Term Solution!", summary: "After talking it out, you decide to alternate holidays each year, with the 'off' family getting a special visit the weekend before.", points: 125, debrief: "This isn't an option in the tree, but represents the best possible outcome. You've created a fair, long-term system that respects both families and removes this point of conflict from your relationship for good. This is strategic, interest-based problem-solving." }
                    }
                }
            },
            {
                id: 'union_deal',
                title: 'The Union Deal',
                costToUnlock: 350,
                context: "You are the lead negotiator for 'AutoMakers Inc.' The contract with the factory workers' union is expiring. The union is demanding a 10% wage increase per year and better healthcare benefits. The company is facing stiff competition and cannot afford such a large increase.",
                goal: "Secure a new 3-year contract that is financially sustainable while avoiding a costly worker strike.",
                player: {
                    batna: "Endure a worker strike, shutting down production and costing millions.",
                    zopa: { walkaway: "A total compensation increase over 7% per year.", target: "An increase below 4% per year, possibly with productivity concessions." }
                },
                counterpart: {
                    name: "Frank, the Union Leader",
                    batna: "Call a strike, which his members have authorized.",
                    interests: "Securing a significant 'win' for his members to maintain his leadership. Ensuring wages keep up with inflation. Improving job security amidst automation fears."
                },
                negotiationTree: {
                    start: {
                        prompt: "Frank opens the negotiation. 'My members are struggling with inflation. We need a 10% raise, better healthcare, and a commitment to no automation-related layoffs for the next 3 years. It's a full package.'",
                        options: [
                            { text: "Tell him the demands are impossible and the company will never agree.", outcome: 'bad_union_impossible' },
                            { text: "Offer a 1% raise and say it's the best the company can do.", next: 'counter_low_union' },
                            { text: "Acknowledge the workers' concerns and ask to tackle one issue at a time, starting with job security.", next: 'ask_one_issue' },
                            { text: "Open the company's financial books to show them why a 10% raise is unsustainable.", next: 'open_books' }
                        ]
                    },
                    counter_low_union: {
                        response: "Frank laughs. '1%? That's an insult. You're not taking this seriously. My members are ready to walk right now.'",
                        options: [
                            { text: "Hold firm on 1%.", outcome: 'bad_union_strike' },
                            { text: "Apologize and shift to a multi-issue discussion.", next: 'ask_one_issue' }
                        ]
                    },
                    ask_one_issue: {
                        response: "Frank seems willing to engage. 'Alright, let's talk job security. We're worried about the new robotics line. What can you offer?'",
                        options: [
                            { text: "Offer a 3-year moratorium on automation layoffs in exchange for a smaller wage increase.", next: 'propose_tradeoff' },
                            { text: "Offer a generous severance package for anyone replaced by automation.", outcome: 'ok_union' },
                            { text: "Say you can't make any promises on job security.", outcome: 'bad_union_impossible' }
                        ]
                    },
                     open_books: {
                        response: "Frank looks surprised, then intrigued. This is a high-risk move of transparency. He and his team review the numbers. He comes back to the table. 'Okay, we see your point on the 10%. But we still need a significant raise. Let's talk about profit-sharing instead.'",
                        options: [
                           { text: "Agree to a profit-sharing plan tied to productivity.", outcome: 'excellent_union_alt' },
                           { text: "Reject profit-sharing and return to a standard wage discussion.", next: 'ask_one_issue'}
                        ]
                    },
                    propose_tradeoff: {
                        response: "Frank is interested. 'Job security is a huge deal for us. If you can guarantee no layoffs, we can be more flexible on wages. What kind of number are you thinking if we get that guarantee?'",
                        options: [
                            { text: "Propose a 3% annual wage increase.", outcome: 'excellent_union' },
                            { text: "Propose a 1.5% annual wage increase.", next: 'counter_low_union' }
                        ]
                    },
                    outcomes: {
                        bad_union_impossible: { title: "Negotiations Collapse", summary: "Your refusal to engage with the union's core issues led to a breakdown in talks.", points: 0, debrief: "By immediately declaring their position impossible, you shut down the negotiation before it could start. Successful negotiation requires exploring the interests behind the positions." },
                        bad_union_strike: { title: "Strike!", summary: "Your lowball offer was seen as an insult, and the union has gone on strike.", points: -50, debrief: "A deliberately low anchor can be perceived as negotiating in bad faith. This destroyed any trust and made a strike almost inevitable. Your BATNA has been triggered, and both sides are now losing." },
                        ok_union: { title: "A Deal is Made, but Tense", summary: "You agreed to a 6% wage increase and a better severance package.", points: 50, debrief: "You avoided a strike, which is a success. However, you engaged in a simple compromise on multiple fronts. You didn't find the most creative trade-offs, leading to a more expensive deal." },
                        excellent_union: { title: "Contract Signed!", summary: "You guaranteed job security in exchange for a sustainable 3% annual wage increase.", points: 100, debrief: "A fantastic outcome. You correctly identified that job security was a more important underlying interest to the union than the exact wage number. By making a major concession on their biggest fear, you gained a major concession on your biggest need (cost control)." },
                        excellent_union_alt: { title: "A Revolutionary Deal!", summary: "By transparently sharing financials, you shifted the negotiation to a profit-sharing model, aligning incentives.", points: 150, debrief: "An incredibly high-risk, high-reward strategy that paid off. Opening your books can be dangerous, but here it built immense trust and changed the game from a zero-sum fight over wages to a collaborative effort to increase profits for everyone. This is expert-level negotiation." }
                    }
                }
            }
        ];

        // --- DOM Elements ---
        const totalPointsDisplay = document.getElementById('total-points-display');
        const scenarioSelection = document.getElementById('scenario-selection');
        const scenarioList = document.getElementById('scenario-list');
        const gameScreen = document.getElementById('game-screen');
        const outcomeScreen = document.getElementById('outcome-screen');
        const pointsAwarded = document.getElementById('points-awarded');
        const scenarioTitle = document.getElementById('scenario-title');
        const scenarioContext = document.getElementById('scenario-context');
        const scenarioGoal = document.getElementById('scenario-goal');
        const playerPerspectiveBtn = document.getElementById('player-perspective-btn');
        const counterpartPerspectiveBtn = document.getElementById('counterpart-perspective-btn');
        const playerPerspectiveDiv = document.getElementById('player-perspective');
        const counterpartPerspectiveDiv = document.getElementById('counterpart-perspective');
        const playerBatna = document.getElementById('player-batna-text');
        const playerZopaWalkaway = document.getElementById('player-zopa-walkaway');
        const playerZopaTarget = document.getElementById('player-zopa-target');
        const counterpartBatna = document.getElementById('counterpart-batna-text');
        const counterpartInterests = document.getElementById('counterpart-interests-text');
        const negotiationLog = document.getElementById('negotiation-log');
        const playerOptions = document.getElementById('player-options');
        const outcomeTitle = document.getElementById('outcome-title');
        const outcomeSummary = document.getElementById('outcome-summary');
        const outcomeDebrief = document.getElementById('outcome-debrief');
        const playAgainBtn = document.getElementById('play-again');
        const backToMenuBtn = document.getElementById('back-to-menu');

        // --- Game State ---
        let currentScenario = null;
        let currentNodeKey = null;
        let totalPoints = 0;
        let unlockedScenarios = [];

        // --- Functions ---

        function loadProgress() {
            const savedData = localStorage.getItem('negotiationGauntletProgress');
            if (savedData) {
                const progress = JSON.parse(savedData);
                totalPoints = progress.totalPoints || 0;
                unlockedScenarios = progress.unlockedScenarios || [scenarios[0].id];
            } else {
                totalPoints = 0;
                unlockedScenarios = [scenarios[0].id];
            }
            updatePointsDisplay();
        }

        function saveProgress() {
            const progress = { totalPoints, unlockedScenarios };
            localStorage.setItem('negotiationGauntletProgress', JSON.stringify(progress));
        }

        function updatePointsDisplay() {
            totalPointsDisplay.textContent = `${totalPoints} NP`;
        }

        function init() {
            loadProgress();
            populateScenarioList();
            showScreen('scenario-selection');
            playAgainBtn.addEventListener('click', () => {
                populateScenarioList();
                showScreen('scenario-selection');
            });
            backToMenuBtn.addEventListener('click', () => {
                populateScenarioList();
                showScreen('scenario-selection');
            });
            playerPerspectiveBtn.addEventListener('click', () => switchPerspective('player'));
            counterpartPerspectiveBtn.addEventListener('click', () => switchPerspective('counterpart'));
        }

        function populateScenarioList() {
            scenarioList.innerHTML = '';
            // Sort scenarios by cost to ensure proper order
            const sortedScenarios = [...scenarios].sort((a, b) => a.costToUnlock - b.costToUnlock);

            sortedScenarios.forEach(scenario => {
                const card = document.createElement('div');
                card.className = 'scenario-card p-6 rounded-lg shadow-md text-left';
                
                const isUnlocked = unlockedScenarios.includes(scenario.id);

                if (isUnlocked) {
                    card.innerHTML = `
                        <h3 class="text-xl font-bold mb-2 text-slate-800">${scenario.title}</h3>
                        <p class="text-sm text-slate-600">${scenario.context.substring(0, 100)}...</p>
                        <div class="mt-4 text-green-600 font-bold">Unlocked</div>
                    `;
                    card.classList.add('cursor-pointer');
                    card.addEventListener('click', () => startGame(scenario.id));
                } else {
                    const canUnlock = totalPoints >= scenario.costToUnlock;
                    card.classList.add('locked');
                    if(canUnlock) card.classList.add('can-unlock');

                    card.innerHTML = `
                        <h3 class="text-xl font-bold mb-2">${scenario.title}</h3>
                        <p class="text-sm">${scenario.context.substring(0, 100)}...</p>
                        <div class="mt-4 flex items-center justify-center font-bold">
                            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                            <span>${canUnlock ? 'Unlock for' : ''} ${scenario.costToUnlock} NP</span>
                        </div>
                    `;
                    if (canUnlock) {
                        card.addEventListener('click', () => unlockScenario(scenario.id, scenario.costToUnlock));
                    }
                }
                scenarioList.appendChild(card);
            });
        }
        
        function unlockScenario(scenarioId, cost) {
            if (totalPoints >= cost) {
                totalPoints -= cost;
                unlockedScenarios.push(scenarioId);
                saveProgress();
                updatePointsDisplay();
                populateScenarioList();
            }
        }

        function showScreen(screenId) {
            scenarioSelection.classList.add('hidden');
            gameScreen.classList.add('hidden');
            outcomeScreen.classList.add('hidden');
            document.getElementById(screenId).classList.remove('hidden');
        }

        function startGame(scenarioId) {
            currentScenario = scenarios.find(s => s.id === scenarioId);
            currentNodeKey = 'start';
            setupScenarioUI();
            updateNegotiationUI();
            showScreen('game-screen');
        }

        function setupScenarioUI() {
            scenarioTitle.textContent = currentScenario.title;
            scenarioContext.textContent = currentScenario.context;
            scenarioGoal.textContent = currentScenario.goal;
            playerBatna.textContent = currentScenario.player.batna;
            playerZopaWalkaway.textContent = currentScenario.player.zopa.walkaway;
            playerZopaTarget.textContent = currentScenario.player.zopa.target;
            counterpartBatna.textContent = currentScenario.counterpart.batna;
            counterpartInterests.textContent = currentScenario.counterpart.interests;
            negotiationLog.innerHTML = '';
            switchPerspective('player');
        }
        
        function switchPerspective(perspective) {
             if (perspective === 'player') {
                playerPerspectiveDiv.classList.remove('hidden');
                counterpartPerspectiveDiv.classList.add('hidden');
                playerPerspectiveBtn.classList.add('active');
                counterpartPerspectiveBtn.classList.remove('active');
            } else {
                playerPerspectiveDiv.classList.add('hidden');
                counterpartPerspectiveDiv.classList.remove('hidden');
                playerPerspectiveBtn.classList.remove('active');
                counterpartPerspectiveBtn.classList.add('active');
            }
        }

        function updateNegotiationUI() {
            const node = currentScenario.negotiationTree[currentNodeKey];
            if (node.response) {
                addLogEntry(currentScenario.counterpart.name, node.response);
            } else {
                 addLogEntry("System", node.prompt);
            }
            playerOptions.innerHTML = '';
            node.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option.text;
                button.className = 'option-btn btn bg-blue-500 text-white font-bold py-3 px-4 rounded-lg w-full text-left leading-tight';
                button.addEventListener('click', () => selectOption(option));
                playerOptions.appendChild(button);
            });
        }

        function selectOption(option) {
            addLogEntry("You", option.text);
            disableOptions();
            setTimeout(() => {
                if (option.outcome) {
                    endGame(option.outcome);
                } else {
                    currentNodeKey = option.next;
                    updateNegotiationUI();
                }
            }, 1200);
        }
        
        function disableOptions() {
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.disabled = true;
                btn.classList.add('opacity-50', 'cursor-not-allowed');
            });
        }

        function addLogEntry(speaker, text) {
            const entry = document.createElement('div');
            entry.className = 'mb-3';
            const speakerClass = speaker === 'You' ? 'font-bold text-blue-600' : 'font-bold text-slate-700';
            entry.innerHTML = `<p class="${speakerClass}">${speaker}:</p><p class="text-slate-800">${text}</p>`;
            negotiationLog.appendChild(entry);
            negotiationLog.scrollTop = negotiationLog.scrollHeight;
        }

        function endGame(outcomeKey) {
            const outcome = currentScenario.negotiationTree.outcomes[outcomeKey];
            totalPoints += outcome.points;
            saveProgress();
            updatePointsDisplay();

            outcomeTitle.textContent = outcome.title;
            outcomeSummary.textContent = outcome.summary;
            pointsAwarded.textContent = `You earned ${outcome.points} NP!`;
            outcomeDebrief.innerHTML = outcome.debrief.split('\n').map(p => `<p class="mb-2">${p}</p>`).join('');
            
            if (outcomeKey.includes('good') || outcomeKey.includes('excellent')) {
                 outcomeTitle.className = 'text-3xl font-bold mb-4 text-green-600';
            } else if (outcomeKey.includes('ok')) {
                outcomeTitle.className = 'text-3xl font-bold mb-4 text-yellow-600';
            } else {
                outcomeTitle.className = 'text-3xl font-bold mb-4 text-red-600';
            }
            
            showScreen('outcome-screen');
        }

        // --- Initialize ---
        init();

    </script>
</body>
</html>
